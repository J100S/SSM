<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Simple Social Media App</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 600px; margin: auto; padding: 1rem; }
  input, button, textarea { font-size: 1rem; margin: 0.25rem 0; width: 100%; }
  #feed { border-top: 1px solid #ccc; margin-top: 1rem; padding-top: 1rem; }
  .post { border-bottom: 1px solid #ddd; padding: 0.5rem 0; }
  .post-user { font-weight: bold; }
  .post-time { color: #888; font-size: 0.8rem; }
  #message { height: 50px; }
</style>
</head>
<body>

<h1>Simple Social Media</h1>

<div id="auth">
  <h2>Register</h2>
  <input type="text" id="reg-username" placeholder="Username" />
  <input type="password" id="reg-password" placeholder="Password" />
  <button id="register-btn">Register</button>

  <h2>Login</h2>
  <input type="text" id="login-username" placeholder="Username" />
  <input type="password" id="login-password" placeholder="Password" />
  <button id="login-btn">Login</button>
</div>

<div id="app" style="display:none;">
  <p>Logged in as <span id="current-user"></span> <button id="logout-btn">Logout</button></p>
  
  <h2>Create Post</h2>
  <textarea id="message" placeholder="What's on your mind?"></textarea>
  <button id="post-btn">Post</button>

  <h2>Feed</h2>
  <div id="feed"></div>
</div>

<script>
  const apiBase = 'http://localhost:3000/api';
  let currentUser = null;

  const authDiv = document.getElementById('auth');
  const appDiv = document.getElementById('app');
  const currentUserSpan = document.getElementById('current-user');
  const feedDiv = document.getElementById('feed');

  // Helper function to show error alerts
  function showError(msg) {
    alert(msg);
  }

  // Register
  document.getElementById('register-btn').onclick = async () => {
    const username = document.getElementById('reg-username').value.trim();
    const password = document.getElementById('reg-password').value;
    if (!username || !password) return showError('Enter username and password');
    
    const res = await fetch(apiBase + '/register', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ username, password }),
    });
    const data = await res.json();
    if (data.error) return showError(data.error);
    alert('Registered! Now login.');
  };

  // Login
  document.getElementById('login-btn').onclick = async () => {
    const username = document.getElementById('login-username').value.trim();
    const password = document.getElementById('login-password').value;
    if (!username || !password) return showError('Enter username and password');

    const res = await fetch(apiBase + '/login', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ username, password }),
    });
    const data = await res.json();
    if (data.error) return showError(data.error);

    currentUser = username;
    currentUserSpan.textContent = currentUser;
    authDiv.style.display = 'none';
    appDiv.style.display = 'block';

    loadFeed();
  };

  // Logout
  document.getElementById('logout-btn').onclick = () => {
    currentUser = null;
    currentUserSpan.textContent = '';
    authDiv.style.display = 'block';
    appDiv.style.display = 'none';
  };

  // Create post
  document.getElementById('post-btn').onclick = async () => {
    const text = document.getElementById('message').value.trim();
    if (!text) return showError('Post message cannot be empty');
    if (!currentUser) return showError('You must be logged in');

    const res = await fetch(apiBase + '/posts', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ username: currentUser, text }),
    });
    const data = await res.json();
    if (data.error) return showError(data.error);

    document.getElementById('message').value = '';
    loadFeed();
  };

  // Load and show feed posts
  async function loadFeed() {
    const res = await fetch(apiBase + '/posts');
    const posts = await res.json();

    feedDiv.innerHTML = '';
    for (const post of posts) {
      const date = new Date(post.timestamp);
      const div = document.createElement('div');
      div.className = 'post';
      div.innerHTML = `
        <div class="post-user">${post.username}</div>
        <div>${post.text}</div>
        <div class="post-time">${date.toLocaleString()}</div>
      `;
      feedDiv.appendChild(div);
    }
  }
</script>

</body>
</html>
